## 10-1 メモリマップ

- 8086は1Mバイトまでのメモリのアクセス
    - 80836は4Gバイトまでのメモリにアクセスすることができる
    - メモリマップは一緒なので同じ方法でアクセスすることができる
- ブートプログラムのロードアドレス
    - ブートプログラムは0x7C00に配置される
- A20問題
    - 物理アドレスを指定した時にオーバーフローすることがあるので連続した20ビットのメモリ空間で構成される
    - よくわかんなかった。

## 10-2 I/Oマップ

- 入出力インターフェースとポートアドレスに関する情報をまとめたもの

## 10-3 ビデオ出力

- 進化していって現在ではVGA出力が一般的
- VGA
    - テキストモードとグラフィックスモードの２種類の画面モードをサポートしている
    - 低レベル入出力をサポートするBIOSを利用すると文字の表示やカーソル制御が利用できる
        - しかし、プロテクトモードではBIOSは使えないためプログラム自作する必要がある
- カラープレーン
    - 画像用のメモリが一定の時、表示可能なドット数を多く取るか表示可能な色数を多く取るかで決まる
    - 一つのドットに4つの光源を用意し、光源が点灯するかしないかで色を表現する
    - 4つの光源の、赤、緑、青、輝度の画面のことをカラープレーンという
        - カラープレーンでメモリをとっていて（赤い画面だったら赤い画面分連続してメモリをとっている)、その番地に0x80みたいな感じでRGBの値を入れていく
- 内部レジスタ
    - カラープレーン(画面表示)のレジスタの制御方法についてのコードが書かれている
    - 完全に理解していないけど面白い

## 10-4 キーボードコントローラの機能と使い方

- キーボードにはキーマトリクスを一定間隔でスキャンし、押されたキーに対応するスキャンコードを通知する専用のコントローラが内蔵されている
- CPUはKBCを介してキーボードを制御する
- 入出力バッファにデータが存在するかどうかを確認してCPUに書き込みを行う
- キーボード制御もしていて、データの再送やLEDの制御とかもやっている

## 10-5 割り込みコントローラの機能と使い方

- 割り込みコントローラ ... どの周辺機器が割り込み信号を発したのかを管理する
- PIC(Programmable Interrupt Controller) 割り込み可能なコントローラ
- マスタPIC, スレーブPICの二つのPICが存在する
- 割り込みのレジスタ
    - ICW 初期化を目的としたレジスタ
        - 何個かテーブルがあるっぽい
    - OCW 初期化終了後の制御を行う
    - 読み込み用のレジスタ
        - IRR  割り込みを要求しているデバイスをみる
        - ISR 処理中の割り込み
        - IMR 不要な割り込みをマスクする
    - 割り込みの検出にはエッジとレベルの２種類を指定することが可能
        - エッジ検出 ... 割り込みしているデバイスの信号が変化したかをみる
        - レベル検出 ... 信号が割り込みレベルのある限り何度でも割り込みを発生させる
    - 残り図のあるところむずい

    ## 10-6 RTCの機能と使い方

    - RTC ... 電源が投入されていない状態でもバックアップ電源により内部的なクロックを動作させ、実時間と同じ時間を取得可能とする周辺機器
        - Timer的なイメージ
        - 0x70-0x71にRTCは接続されている
        - RTCの初期化はBIOSが行う
        - OSC ...　基準となる信号を生成するハードウェアのこと。オシレータ、発信機
        - 分周とかの表現もRTCからくる
    - VRT ... (Valid RAM and Time) バックアップ用電源を監視する、PS入力端子を反映する。Read Only。途中で電断するとRAMのデータも消える

    ## 10-7 タイマーの機能と使い方

    - PCには周期的な信号を生成するためタイマーICが実装されている
        - 基準となる入力信号を分周し、システムが必要とする周期的な信号を生成するため使用される
    - ラッチ ... ある時点での状態やデータを保存しておくこと
        - タイマーICがポートを介してアクセスするときラッチカウンタを読み込むようにしている。常にカウントが行われているため。

    ## 10-8 数値演算コプロセッサ機能と使い方

    - 数値演算コプロセッサ ... 少数演算を専門に行う演算装置。内部で扱うデータが浮動小数点形式であることからFPU(Floating Point Unit)とも呼ばれる
    - FPUレジスタ
        - レジスタスタック
            - 80ビット (10バイト)のレジスタを使用して数値演算が行われる
            - 8本のレジスタが使用可能であり、これらをレジスタスタックと呼んでいる
            - 先頭のレジスタはST, ST(0)でアクセス可能でそれより後ろはオフセットでアクセスできる
            - FPU命令で使うBCDというデータ方は２進化１０進数とも呼ばれて、二進数を使いながらも10で桁上がりが行われる
        - ステータスレジスタ
            - FPUの内部状態を確認することができる
        - 制御レジスタ
            - 丸め制御や精度制御がある
        - FPU命令
            - 命名ルール
                - Fから命令が始まる
                - FI ... 整数型を扱う命令
                - 末尾にP ... レジスタスタックのポップを伴うFPUU命令
            - ロード命令
                - fild, fbld, fld
                    - fildは小さめのデータサイズ、fbldは10バイトのみ、fldは大きめのデータサイズ
            - ストア命令
                - サイズ様々。fbstが大きいの専用
            - 定数ロード命令
                - 定数、piとかの数字の定数がある
            - 加算命令, 減算命令, 乗算命令, 除算命令, 三角関数命令
                - 頭文字FI(), F()の命令。FIだと整数型っぽい
            - レジスタ交換命令
                - FXCH st(0)と第一オペランドで指定されたレジスタの内容を入れ替える
                - 指定がない場合はst(0)とst(1)が入れ替わる
            - 符号操作命令
                - FCHS st(0)の符号を反転する
            - 剰余命令
                - FPREM ST(0)をST(1)でmodしてst(0)にあまりを保存する
            - 制御命令
                - FNINT, FPUの内部状態を初期化する
                - FNSAVE, FPUの全てのコンテキストを指定したアドレスに保存してからFPUを初期化する。レジスタの書き換えはしない
                - FRSTOR, FRSTORはFNSAVEで保存されたFPUコンテキストを復帰する

        ## 10-9 大容量記憶装置

        - パーティション
            - 内部領域を分割した一つの領域。最大4つまでしか作成できない
            - ブートコードでパーティションに関する情報が記録される
            - ブートプログラムが起動パーティションを選択する
            - パーティション情報のタイプ(MacとかWindows)も管理されている
        - FATファイルシステム
            - ファイル管理をするときのフォーマットを確認する
            - 一般的なOSとのデータ交換を実現することが可能になる
            - ファイルを分割してクラスタという単位にし、クラスタの配列として管理する。
            - クラスタのインデックスによって呼び方が変わる
                - FAT12 インデックスが12ビット
                - FAT16, FAT32
            - インデックスの0, 1は管理用に使うため、インデックスの最小値は2になる
            - FAT(File Allocation Table) 分割されたファイルの順番を記録するためのインデックス配列がクラスタ配列と別に確保される。インデックス配列のことをFATという