# 第4章 ファイルシステムの仕組み
ファイルシステムはファイルを使ってデータを管理するプログラムの集まりのこと

## 4-1 ファイル情報

- ファイル情報
    - 属性 ... 保存したデータに関する情報、メタデータ
    - データ ... データそのもの
- データのアクセス方法
    - シーケンシャルアクセス ... データの先頭から順番にアクセスしていく
    - ランダムアクセス ... ランダムにデータにアクセスしていく
- ファイルシステムは保存されるデータをバイトデータの並びとし、そのデータへのシーケンシャルアクセスを提供している
    - これって実装的にはバイトの並び列をバイトの取得分だけ飛ばして順番にアクセスしていくって感じなのかな
- ファイルディスクリプタ ... プロセスがファイルを特定するために必要となる情報
    - ボリューム(Volume) ... 実際にファイルを保存する物理的な媒体

## 4-2 ファイル操作の基本的なシステムコール

- SEEK ... アクセス位置の変更
- OPEN/CLOSE/CREATEなどたくさん

## 4-3 通常ファイルと特殊ファイル

- ファイルの種類
    - 通常ファイル ... データの保存を主な目的としたファイル
    - 特殊ファイル ... ファイルと入力デバイスを関連づけてデバイスごとに異なるアクセス方法の差異を吸収するためのファイル
    - キャラクタ型/ブロック型 → 人間が読むよう/機械が読むよう

## 4-4 シーケンシャルアクセスとランダムアクセス

- アクセス
    - シーケンシャルアクセス
        - ファイル間の区切りはEOFで区切られる。欲しいデータを探すときは連続した磁気テープを順番に読むしかない。磁気テープを飛ばすときに使うんだと思う多分。
    - ランダムアクセス
        - 位置を指定することで一意にデータを特定することができるデバイス
        - 外部記憶装置であれば、セクタ番号を指定することでデータを特定できる
- ファイル
    - シーケンシャルアクセスファイル
        - O行目のデータを探すときに、改行回数をみて、ファイルの先頭からデータを読み込んでいく
    - ランダムアクセスファイル
        - 複数の情報を一つにまとめたレコードと呼ばれる固定長のデータを配列としてもつ
        - シーケンシャルアクセスファイルよりデータは大きくなりそう
    - ファイルバッファ ... ふつーにファイルのバッファ。データが溜まったら一気に書き込みの処理をする。余計なIOを減らす

    ## 4-5 ファイルシステムの階層構造

    最上位層 ... プロセスに対してシステムコールを使った共通ファイルの操作法を提供する

    最下位層 ... 物理的な記憶装置に対して、データの読み書きを行うタモのコマンドを発行し、結果の割り込みや定期的な状態確認を行い上位層に通知をする。e.g. デバイスドライバ

    ## 4-6 ファイル名 記録データの識別方法

    - ファイルシステムによって名前が正しくコピーされないことがある
        - file, File → file になる
        - 長いファイル名が途中で切られる
    - 拡張子 ... アプリケーションがデータの内容を判別するための手段として利用
        - これはファイルシステムの要求や制限ではなく利便性のため

    ## 4-7 ディレクトリ 論理的グループによるデータ管理

    - ファイルのグループ、逆ツリー構造
    - ディレクトリの実態 ... ファイルやディレクトリの一覧がデータとして保存された通常ファイル
        - なるほど....!!!! ただのファイルなんだw 保存場所違ってもいいし、書き換えも楽だな。なるほどねぇ〜〜〜
    - セパレータ ... ディレクトリとファイル名の区切り

    ## 4-8 ブロック単位でのデータ管理方法

    - ブロック単位で保存する場合、1バイトのデータを保存するだけでも4Kバイト必要になる
    - 複数ブロックでファイルを管理する場合
        - ❌ 連続でブロックを確保していく
            - メモリの問題
        - 連結リストでの管理
            - 分割されたファイルのブロック番号を配列として管理する
            - ファイルサイズが大きくなった場合でも管理用の配列は連続して配置が必要
        - 可変長インデックス配列での管理
            - 管理データで属性のデータ番号をまとめておく
            - ブロックデータは適当な位置に配置
        - 固定長インデックス配列での管理
            - 全てのブロックを管理するための配列を事前に用意する必要はない
            - サイズが記憶装置の大容量化により無視できなくなるかも
            - 可変長の方が良さそう