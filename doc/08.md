## 8-1 CPU命令によるプログラムの作成手順

- ニーモニック ... 機械語を人間にわかりやすい記号に置き換える

    ```c
    MOV AX, BX; みたいな感じ
    ```

- アセンブル ... ニーモニックからCPUが理解できる機械語に変換する作業、実は単純にビットに置き換えるだけで人手で行うことも難しくない。これを自動化する専用のソフトウェアをアセンブラという
- NASM ... アセンブラの種類
- ソースファイルの書き方 ... ラベル、命令、コメントで構成される
    - ラベル ... 機械語が配置されるアドレスを文字列に置き換える。ラベルは「：」で終わらせる
    - 命令
        - CPU命令 ... CPUに対する命令
        - 擬似命令 ... アセンブラに対する命令
    - オペコード ... CPUに対する命令
    - オペランド ... 操作対象のこと

    ```c
    オペコード    第1オペランド    第2オペランド
    MOV         AX,          BX
    ```

- 即値 ... 0x0Fのようなアセンブラが変換する必要のない値
- メモリオペランド

    ```c
    MOV [0x8000], (データサイズ) 0x0F // [0x8000]がメモリオペランド
    // データサイズは byte, word, dwordを入れることによって、生成される機械語の長さが変わる
    // これはCISCと呼ばれるCPUに分類される
    ```

- IPレジスタ
    - 次に実行する機械語命令が格納されているアドレスを保持している
    - IPレジスタがあるおかげでJMP命令溶かしても、間に何バイトの機械語命令が存在するか把握することができる
- セグメントオーバーライド
    - CPUのメモリアクセスではセグメントレジスタが参照される。セグメントの種類によってメモリ参照の種類が変わる
    - セグメントオーバーライドはデフォルトで参照されるセグメントを変更する

## 8-2 CPU命令とその使用例

- MOV
    - 転送命令。第二オペランドの値を第一オペランドにコピーする
    - ax=0x12みたいなイメージ
    - ビット幅が同じじゃないとダメ
- MOVZX, MOVSX
    - 転送と変換命令
    - 拡大コピーする命令。第一オペランドの方がビット幅が大きい
    - MOVZXは上位ビットを０に設定する
    - MOVSXは第二オペランドの最上位ビットを設定する符号拡張が行われる
        - 例を見るとMOVZX命令の0じゃなくてFが入るっぽいな
- CBW, CWD, CDQ, CWDE
    - 変換命令
    - レジスタの値をいい感じの整数に変換する
- LEA
    - 実行アドレスロード命令
    - 第一オペランドで指定したレジスタに第二オペランドのアドレッシングで生成された値を設定する
    - 第一オペランドはレジスタ、第二オペランドはアドレッシング
    - 算術演算を目的として使用されることがある
- NOP
    - 無操作命令
    - IPレジスタの値を加算する
- XCHG
    - 交換命令
    - 第一オペランドと第二オペランドの値を交換する
- ADD. ADC, INC
    - 加算命令
    - 第二オペランドの値を第一オペランドに加算する
        - ADD: A+=B
        - ADC: A+=B+CarryFlag
        - INC: A++; って感じか
- SUB, SBB, DEC
    - 減算命令
    - SUB: A-= B
    - SBB: A-= B - CarryFlag
    - DEC: A--;
- MUL. IMUL
    - 乗算命令
    - MULが符号なし乗算、IMULが符号あり
- DIV, IDIV
    - 除算命令
    - MULと同じ、DIVが符号なし
- AND, OR, XOR, NOT, NEG
    - ビット操作命令
    - NOTはオペランドに1の補数を、NEGは2の補数を設定する
- SHL/SHR, SAL/SAR, ROL/ROR, RCL/RCR
    - Lがついてるやつは左シフト、Rがついてるやつは右シフトする
    - 空きビットには0が代入されて押し出されたビットはCFにセットされる
    - シフトしたときの動き方が違う(あんまりちゃんと読んでない)
- BT, BTS/BTR/BTC, TEST
    - ビットテスト命令
    - BTS ... BT命令後にメモリの値をセット
    - BTR ... BT命令後にメモリの値をリセット
    - BTC ... 同上でビットの反転を行う
    - TEST ... 第1,2オペランドのAND演算を行い、フラグに反映させる。演算結果は破棄する
    - よくわからん🤔
- CMP
    - 比較命令
    - オペランドの減算を行ってフラグに反映するらしい
- JMP
    - ジャンプ命令, IPレジスタの値をオペランドで指定した値に変更する
        - IPレジスタは次に実行する機械語命令が格納されているアドレスを保持しているため、ここを書き換えることにより、処理を飛ばすことができる
    - 指定されたアドレスから処理を開始することができる
- Jcc (Jから始まる命令)
    - 条件分岐命令。めっちゃ大事そう。13章見たけど、if文の実装には必須っぽい
    - 基本的には減算して二つの値が一致するかを調べるっぽい
        - JZ Jump if Zero
        - JE Jump if Equal
        - JNZ Jump if Not Zero
