# 11章 BIOSの役割

## 11-1 BIOSが提供するサービス
- BIOSは関数の集まり
    - 一般の関数との違い
        - ハードウェアの制御が可能
        - ソフトウェア割り込みで実装されていること
            - 割り込み番号で区別される
- サービスプログラムとも言われる
    - BIOSの提供する機能のことをサービスという
- BIOSコール＝BIOS呼び出し
    - ビデオ、ディスク、システム、キーボードの制御といったBIOSコールがある

## 11-2 ビデオサービスとその使用例
- 画面出力をする
- INT 0x10がビデオサービス、(AH=...)でビデオサービスの機能の設定ができる
- 画面のカーソル位置に文字「A」を表示する例
```
mov     ah, 0x0E;// モード
mov     al, 'A'; // 文字コード
mov     bh, 0;   // ページ番号
mov     bl, 0;   // 文字色
int     0x10;    // BIOSのテレタイプ式一文字出力
```

## 11-3 ディスクサービスとその使用例
- セクタ単位でのアクセス機能を提供
- CHS方式でディスクのアクセスを行う
    - 1-4あたりの内容
- シリンダ、セクタを16ビットのCCXレジスタで指定
- ドライブの指定はDLレジスタで行う

## 11-4 システムサービスとその使用例
- ハードウェアの構成やシステム情報などを問い合わせる
- A20 gate信号(p234) の制御とプロテクトモードの時に参照するメモリマップを取得するBIOSコールが紹介されている

## 11-5 キーボードサービスとその使用例
- キーが押されるまで制御を戻さない
- ユーザからのキー入力待ちコード
```
mov     ah, 0x00;  // キー入力待ち
int     0x16;      // AL = BIOS(0x16, 0x00)
```

## 11-6 その他のサービス
- システムの再起動とかできる
    - ブートセクタの読み出しから再開するがメモリの初期化などは行わない

## 11-7 ACPIによる電源管理と制御例
- 昔は電源付けっぱで消すことがなかったが、現在はPCをオフにすることも多い
    - 不用意に電源を切ると、OSの内部状態やファイルの記録状態が不完全になる
    - OSが再起動できなくなることも(ゲームのセーブ時も似たような状態かな) 
- ACPI(Advanced Configuration and Power Interface) ... 電源に関する機能を提供
    - ACPIハードウェア > ACPIレジスタ > ACPIテーブルで管理。レジスタの存在もテーブルで管理する
    - ある程度プログラミングする必要がある
    - 電源状態はS0-S5まであり、数が小さいほど動いている
    - レジスタアドレスの取得はFADTから取得する
- DSDT レジスタに設定するシステム状態
    - 定義ブロックはASLというソースコードがあり、ここから機械語に直したAMLというコードが生成される
    - パッケージの取得 (めっちゃ書いてあるけどあんまり想像がつかなかった)
```
defPackage := 0x12 PackageOp // パッケージオプション
              0x0A PkgLength // パッケージ長
              0x04 NumElements // 要素数
              0x0A 0x00
              0x0A 0x01
              0x0A 0x02
              0x0A 0x03
```
