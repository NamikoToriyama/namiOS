# 第2章(ソフトウェアの基礎)
## 2-1 チューリングマシン

計算基礎論でやった系の話

- テープで表せる = 計算可能 みたいな話なのかな。
- ちゃんと読んでない

## 2-2 OSの主な役割

めっちゃアーキテクチャでやったなこれ

- リソース管理
    - CPU時間の割り当て
- プロセス管理
- インターフェイスの管理
    - アーキテクチャの授業で言うとアプリケーションサービスを提供したり、いい感じにするやつ

## 2-3 プロセス

- インスタンス ... プログラムの実行状態
    - OSは複数のインスタンスを並列実行するように調整する
- プロセス = インスタンス + OS管理情報
    - 複数プロセスはリソースのアクセス権利をgetして処理を行う
        - Create, Ready, Block, Running, Terminated
- スケジューリング ... プロセスの実行
    - クォンタム .... OSからプロセスに割り当てられた時間
    - プリエンティブ ... クォンタムを使い切ったプロセスを定期的に切り替える方式
    - ⇄ ノンプリエンティブ, 協調型マルチタスク ... プロセスが自発的に他のプロセスのアクセス権を奪い合う
- プロセスの逆木構造
    - 子プロセスとか孫プロセスとかを表現するのに使われる
    - 親プロセス = ルートプロセス
    - 権限は親以下の権限になる

## 2-4 カーネル

- カーネル ... OSの中心的機能を持ったプログラムや集まりのこと
- 特権状態 ... super userとかのOS版とかかな？
- システムコール ... リソースに対するアクセス方法。非特権モードのものが特権モードにアクセスするにはシステムコールを介する必要がある
- カーネルの種類
    - マイクロカーネル ... カーネル自体を小さく。モジュール間の通信でパフォーマンス低下することがある
    - モノリシックカーネル ... 全ての機能をOS本体に含む
- サブシステム ... プロセスからの要求を受け付けさせるような補助的プログラム。シェルは補助的プログラムっぽい。システムコールの呼び出しに使う

## 2-5 同期処理

- 同期処理 ... 複数プロセス間で必要となる実行制御のこと
- 排他制御 ... 他プロセスが同じリソースを利用できないように制御すること
- クリティカルセクション ... 一つのプロセスが共有できないリソースにアクセスしている期間
- 排他制御の方法
    - ソフトウェア ... デッカーのアルゴリズム
    - ハードウェア ... テストアンドセット
    - ハードウェア + OS ... セマフォ
- p114 フラグによる排他制御
    - 1は両方ともクリティカルセクションに入ってしまってダメになるパターン
    - 2はクリティカルセクションにはならないが両方のプロセスが永遠に待ち状態になる現象が起こる
        - コンテキストスイッチングによって待ちになる
- 割り込み禁止
    - 上のフラグによる排他制御がダメなのは割り込みが原因
    - でも割り込み禁止にすると困る
        - 1つのCPUで割り込みを禁止にしても、複数CPUある場合は他のCPUで割り込みが起きたりする
        - プロセス間のリソースアクセス制御はCPU間に置き換えても同様に動く必要あり
        - システム全体の動作にも影響あり
            - キーボードからの入力とか
            - タスクスイッチングもタイマーが使われる
- 共有変数の使用
    - turnを共有変数にしている
    - プロセスは常に共有変数の値をチェックする必要がある
    - プロセスが多くなるにつれ影響が出るらしい
        - なんでだろうね?
- デッカーのアルゴリズム
    - さっきのアルゴリズムに加えて、プロセス要求するような変数をつける
    - リソースを確保したら要求を取り下げるようにする
        - 途中でコンテキストスイッチング来ても大丈夫そう
    - 🙅‍♀️ プロセスが多い場合にだめ
        - 互いのプロセスを認識する必要があるので、プロセスの数だけグローバル変数が必要
- テストアンドセット
    - 問題点だった「各プロセスが、共有変数の「値の確認と更新」を「一つの命令」で行えなかったこと」を解決した
        - コンテキストスイッチングで他プロセスが値を変更してしまうことが怖かった
    - 用語
        - ロック信号 ... メモリへのアクセスを継続中であることを示す信号
        - アトミック(Atomic)信号 ... 分割されない一連の処理
    - プロセスにローカル変数を置いてグローバル変数を読み込む
        - デッカーのグローバル変数増える問題が解決
    - 🙅‍♀️ ビジーウェイトループの問題はまだ残ったまま
- セマフォ Semaphore
    - P命令とV命令によってのみ値が変更される整数型変数Sを用いた同期処理
        - 簡単にいうといい感じに排他制御してくれるやつ
    - P命令
        - S -= 1
        - 0 ≤ S → continue
        - S < 0ならV命令により 0≤Sとなるまでブロックされる
    - V命令
        - S += 1
        - 処理継続
        - S ≤ 0の時、ブロック状態にあるプロセスの一つを待機状態にする

## 2-6  デッドロック

- デッドロックを回避する方法
    - 事前に防止
    - 自動検出
    - デッドロックに陥った場合はプロセスを強制終了する
- デッドロックが発生する条件(全て揃うと危ない
    - リソースの取得に対して排他的なアクセス制御がある
    - リソースを保有しているプロセスが新しいリソースを要求できる
    - プロセスが所有しているリソースを強制で取り上げることができない
    - 複数プロセスが異なる順序で複数リソースを要求できる
- 食事する哲学者の問題
    - 粕川先生がめっちゃ説明してたけど、これ人をプロセスとして見立ててたんだね〜。なるほど

## 2-7 スケジューリング

- スケジューリング ... 次に決定すべきプロセスを決定すること
- コンテキストスイッチング
    - 実行状態にあるプロセスが自身に割り当てられたクォンタムを使い切ると発生する
    - レジスタの保存と復帰、メモリマップの保存と復帰、プロセスの管理テーブルやリンクリストの更新などが行われる
    - クォンタムが短いほど、プロセスの切り替え回数が多くなるので、反応速度が早くなるが、スイッチングの頻度が多くなるので全体的なCPUの使用効率が低下する
        - 例えば、プログラム実行中に他のアプリケーションなどの起動をしたい時、クォンタムが短いとすぐに起動できるが、長いとそのクォンタムの時間分だけ待たされるイメージ
- ラウンドロビンスケジューリング
    - 全てのプロセスに対してクォンタムを均等に割り当てる
- 優先度付スケジューリング
    - 各プロセスの優先順位を動的に変更することができる
    - フォアグランドプロセス ... 使用権限を得たユーザーとインターフェイスを処理するプロセス
    - バックグラウンドプロセス ... 　それ以外
- ターンアラウンドタイム ... プロセスの実行が要求されてから終了するまでの時間
- リアルタイム ... 決められた許容範囲内で処理が終了すること。体感的な速さではなく、システムで決められた具体的な時間内の処理