KBC_Data_Write:
        ; ---------------------------------
        ; スタックフレームの構築
        ; ---------------------------------
                                            ; +4|データ
                                            ; +2|IP(戻り番地)
        push    bp                          ; BP+0|BP(元の値)
        mov     bp, sp         

        ; ---------------------------------
        ; レジスタの保存
        ; ---------------------------------
        push    cx

        ; ---------------------------------
        ; バッファへの書き込み処理
        ; ---------------------------------         
        mov     cx, 0

.10L:
        in      al, 0x64                    ; KBCステータス
        test    al, 0x02                    ; 書き込み可能
        loopnz  .10L

        cmp     cx, 0                       ; if(CX)
        jz      .20E

        mov     al, [bp + 4]
        out     0x60, al

.20E:
        mov     ax, cx                       ; return CX;

        ; ---------------------------------
        ; レジスタの復帰
        ; ---------------------------------
        pop    cx

        ; ---------------------------------
        ; スタックフレームの破棄
        ; ---------------------------------
        mov     sp, bp
        pop     bp

        ret

KBC_Data_Read:
        ; ---------------------------------
        ; スタックフレームの構築
        ; ---------------------------------
                                            ; +4|データ
                                            ; +2|IP(戻り番地)
        push    bp                          ; BP+0|BP(元の値)
        mov     bp, sp         

        ; ---------------------------------
        ; レジスタの保存
        ; ---------------------------------
        push    cx

        ; ---------------------------------
        ; バッファへの書き込み処理
        ; ---------------------------------         
        mov     cx, 0

.10L:
        in      al, 0x64                    ; KBCステータス
        test    al, 0x02                    ; 書き込み可能
        loopnz  .10L

        cmp     cx, 0                       ; if(CX)
        jz      .20E

        mov     di, [bp + 4]
        mov      [di + 0], ax

.20E:
        mov     ax, cx                       ; return CX;

        ; ---------------------------------
        ; レジスタの復帰
        ; ---------------------------------
        pop    cx

        ; ---------------------------------
        ; スタックフレームの破棄
        ; ---------------------------------
        mov     sp, bp
        pop     bp

        ret

KBC_Cmd_Write:
        ;-----------------------------------------
        ; 【スタックフレームの構築】
        ;-----------------------------------------
        push bp
        mov bp, sp

        ;-----------------------------------------
        ; 【レジスタの保存】
        ;-----------------------------------------
        push cx

        ;-----------------------------------------
        ; コマンド書き込み
        ;-----------------------------------------
        mov cx, 0
.10L:
        in al, 0x64
        test al, 0x02
        loopnz .10L

        cmp cx, 0
        jz .20E

        mov al, [bp + 4]
        out 0x64, al
.20E:
        mov ax, cx

        ;-----------------------------------------
        ; 【レジスタの復帰】
        ;-----------------------------------------
        pop cx

        ;-----------------------------------------
        ; 【スタックフレームの破棄】
        ;-----------------------------------------
        mov sp, bp
        pop bp

        ret
